{"ast":null,"code":"import _defineProperty from\"C:/Users/BIRAJ/Desktop/react-slack-clone/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _classCallCheck from\"C:/Users/BIRAJ/Desktop/react-slack-clone/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"C:/Users/BIRAJ/Desktop/react-slack-clone/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"C:/Users/BIRAJ/Desktop/react-slack-clone/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"C:/Users/BIRAJ/Desktop/react-slack-clone/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from\"react\";import uuidv4 from\"uuid/v4\";import firebase from\"../../firebase\";import{Segment,Button,Input}from\"semantic-ui-react\";import FileModal from\"./FileModal\";import ProgressBar from\"./ProgressBar\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var MessageForm=/*#__PURE__*/function(_React$Component){_inherits(MessageForm,_React$Component);var _super=_createSuper(MessageForm);function MessageForm(){var _this;_classCallCheck(this,MessageForm);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={storageRef:firebase.storage().ref(),uploadTask:null,uploadState:\"\",percentUploaded:0,message:\"\",channel:_this.props.currentChannel,user:_this.props.currentUser,loading:false,errors:[],modal:false};_this.openModal=function(){return _this.setState({modal:true});};_this.closeModal=function(){return _this.setState({modal:false});};_this.handleChange=function(event){_this.setState(_defineProperty({},event.target.name,event.target.value));};_this.createMessage=function(){var fileUrl=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var message={timestamp:firebase.database.ServerValue.TIMESTAMP,user:{id:_this.state.user.uid,name:_this.state.user.displayName,avatar:_this.state.user.photoURL}};if(fileUrl!==null){message[\"image\"]=fileUrl;}else{message[\"content\"]=_this.state.message;}return message;};_this.sendMessage=function(){var getMessagesRef=_this.props.getMessagesRef;var _this$state=_this.state,message=_this$state.message,channel=_this$state.channel;if(message){_this.setState({loading:true});getMessagesRef().child(channel.id).push().set(_this.createMessage()).then(function(){_this.setState({loading:false,message:\"\",errors:[]});}).catch(function(err){console.error(err);_this.setState({loading:false,errors:_this.state.errors.concat(err)});});}else{_this.setState({errors:_this.state.errors.concat({message:\"Add a message\"})});}};_this.getPath=function(){if(_this.props.isPrivateChannel){return\"chat/private-\".concat(_this.state.channel.id);}else{return\"chat/public\";}};_this.uploadFile=function(file,metadata){var pathToUpload=_this.state.channel.id;var ref=_this.props.getMessagesRef();var filePath=\"\".concat(_this.getPath(),\"/\").concat(uuidv4(),\".jpg\");_this.setState({uploadState:\"uploading\",uploadTask:_this.state.storageRef.child(filePath).put(file,metadata)},function(){_this.state.uploadTask.on(\"state_changed\",function(snap){var percentUploaded=Math.round(snap.bytesTransferred/snap.totalBytes*100);_this.setState({percentUploaded:percentUploaded});},function(err){console.error(err);_this.setState({errors:_this.state.errors.concat(err),uploadState:\"error\",uploadTask:null});},function(){_this.state.uploadTask.snapshot.ref.getDownloadURL().then(function(downloadUrl){_this.sendFileMessage(downloadUrl,ref,pathToUpload);}).catch(function(err){console.error(err);_this.setState({errors:_this.state.errors.concat(err),uploadState:\"error\",uploadTask:null});});});});};_this.sendFileMessage=function(fileUrl,ref,pathToUpload){ref.child(pathToUpload).push().set(_this.createMessage(fileUrl)).then(function(){_this.setState({uploadState:\"done\"});}).catch(function(err){console.error(err);_this.setState({errors:_this.state.errors.concat(err)});});};return _this;}_createClass(MessageForm,[{key:\"render\",value:function render(){// prettier-ignore\nvar _this$state2=this.state,errors=_this$state2.errors,message=_this$state2.message,loading=_this$state2.loading,modal=_this$state2.modal,uploadState=_this$state2.uploadState,percentUploaded=_this$state2.percentUploaded;return/*#__PURE__*/_jsxs(Segment,{className:\"message__form\",children:[/*#__PURE__*/_jsx(Input,{fluid:true,name:\"message\",onChange:this.handleChange,value:message,style:{marginBottom:\"0.7em\"},label:/*#__PURE__*/_jsx(Button,{icon:\"add\"}),labelPosition:\"left\",className:errors.some(function(error){return error.message.includes(\"message\");})?\"error\":\"\",placeholder:\"Write your message\"}),/*#__PURE__*/_jsxs(Button.Group,{icon:true,widths:\"2\",children:[/*#__PURE__*/_jsx(Button,{onClick:this.sendMessage,disabled:loading,color:\"orange\",content:\"Add Reply\",labelPosition:\"left\",icon:\"edit\"}),/*#__PURE__*/_jsx(Button,{color:\"teal\",disabled:uploadState===\"uploading\",onClick:this.openModal,content:\"Upload Media\",labelPosition:\"right\",icon:\"cloud upload\"})]}),/*#__PURE__*/_jsx(FileModal,{modal:modal,closeModal:this.closeModal,uploadFile:this.uploadFile}),/*#__PURE__*/_jsx(ProgressBar,{uploadState:uploadState,percentUploaded:percentUploaded})]});}}]);return MessageForm;}(React.Component);export default MessageForm;","map":{"version":3,"sources":["C:/Users/BIRAJ/Desktop/react-slack-clone/src/components/Messages/MessageForm.js"],"names":["React","uuidv4","firebase","Segment","Button","Input","FileModal","ProgressBar","MessageForm","state","storageRef","storage","ref","uploadTask","uploadState","percentUploaded","message","channel","props","currentChannel","user","currentUser","loading","errors","modal","openModal","setState","closeModal","handleChange","event","target","name","value","createMessage","fileUrl","timestamp","database","ServerValue","TIMESTAMP","id","uid","displayName","avatar","photoURL","sendMessage","getMessagesRef","child","push","set","then","catch","err","console","error","concat","getPath","isPrivateChannel","uploadFile","file","metadata","pathToUpload","filePath","put","on","snap","Math","round","bytesTransferred","totalBytes","snapshot","getDownloadURL","downloadUrl","sendFileMessage","marginBottom","some","includes","Component"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport uuidv4 from \"uuid/v4\";\nimport firebase from \"../../firebase\";\nimport { Segment, Button, Input } from \"semantic-ui-react\";\n\nimport FileModal from \"./FileModal\";\nimport ProgressBar from \"./ProgressBar\";\n\nclass MessageForm extends React.Component {\n  state = {\n    storageRef: firebase.storage().ref(),\n    uploadTask: null,\n    uploadState: \"\",\n    percentUploaded: 0,\n    message: \"\",\n    channel: this.props.currentChannel,\n    user: this.props.currentUser,\n    loading: false,\n    errors: [],\n    modal: false\n  };\n\n  openModal = () => this.setState({ modal: true });\n\n  closeModal = () => this.setState({ modal: false });\n\n  handleChange = event => {\n    this.setState({ [event.target.name]: event.target.value });\n  };\n\n  createMessage = (fileUrl = null) => {\n    const message = {\n      timestamp: firebase.database.ServerValue.TIMESTAMP,\n      user: {\n        id: this.state.user.uid,\n        name: this.state.user.displayName,\n        avatar: this.state.user.photoURL\n      }\n    };\n    if (fileUrl !== null) {\n      message[\"image\"] = fileUrl;\n    } else {\n      message[\"content\"] = this.state.message;\n    }\n    return message;\n  };\n\n  sendMessage = () => {\n    const { getMessagesRef } = this.props;\n    const { message, channel } = this.state;\n\n    if (message) {\n      this.setState({ loading: true });\n      getMessagesRef()\n        .child(channel.id)\n        .push()\n        .set(this.createMessage())\n        .then(() => {\n          this.setState({ loading: false, message: \"\", errors: [] });\n        })\n        .catch(err => {\n          console.error(err);\n          this.setState({\n            loading: false,\n            errors: this.state.errors.concat(err)\n          });\n        });\n    } else {\n      this.setState({\n        errors: this.state.errors.concat({ message: \"Add a message\" })\n      });\n    }\n  };\n\n  getPath = () => {\n    if (this.props.isPrivateChannel) {\n      return `chat/private-${this.state.channel.id}`;\n    } else {\n      return \"chat/public\";\n    }\n  };\n\n  uploadFile = (file, metadata) => {\n    const pathToUpload = this.state.channel.id;\n    const ref = this.props.getMessagesRef();\n    const filePath = `${this.getPath()}/${uuidv4()}.jpg`;\n\n    this.setState(\n      {\n        uploadState: \"uploading\",\n        uploadTask: this.state.storageRef.child(filePath).put(file, metadata)\n      },\n      () => {\n        this.state.uploadTask.on(\n          \"state_changed\",\n          snap => {\n            const percentUploaded = Math.round(\n              (snap.bytesTransferred / snap.totalBytes) * 100\n            );\n            this.setState({ percentUploaded });\n          },\n          err => {\n            console.error(err);\n            this.setState({\n              errors: this.state.errors.concat(err),\n              uploadState: \"error\",\n              uploadTask: null\n            });\n          },\n          () => {\n            this.state.uploadTask.snapshot.ref\n              .getDownloadURL()\n              .then(downloadUrl => {\n                this.sendFileMessage(downloadUrl, ref, pathToUpload);\n              })\n              .catch(err => {\n                console.error(err);\n                this.setState({\n                  errors: this.state.errors.concat(err),\n                  uploadState: \"error\",\n                  uploadTask: null\n                });\n              });\n          }\n        );\n      }\n    );\n  };\n\n  sendFileMessage = (fileUrl, ref, pathToUpload) => {\n    ref\n      .child(pathToUpload)\n      .push()\n      .set(this.createMessage(fileUrl))\n      .then(() => {\n        this.setState({ uploadState: \"done\" });\n      })\n      .catch(err => {\n        console.error(err);\n        this.setState({\n          errors: this.state.errors.concat(err)\n        });\n      });\n  };\n\n  render() {\n    // prettier-ignore\n    const { errors, message, loading, modal, uploadState, percentUploaded } = this.state;\n\n    return (\n      <Segment className=\"message__form\">\n        <Input\n          fluid\n          name=\"message\"\n          onChange={this.handleChange}\n          value={message}\n          style={{ marginBottom: \"0.7em\" }}\n          label={<Button icon={\"add\"} />}\n          labelPosition=\"left\"\n          className={\n            errors.some(error => error.message.includes(\"message\"))\n              ? \"error\"\n              : \"\"\n          }\n          placeholder=\"Write your message\"\n        />\n        <Button.Group icon widths=\"2\">\n          <Button\n            onClick={this.sendMessage}\n            disabled={loading}\n            color=\"orange\"\n            content=\"Add Reply\"\n            labelPosition=\"left\"\n            icon=\"edit\"\n          />\n          <Button\n            color=\"teal\"\n            disabled={uploadState === \"uploading\"}\n            onClick={this.openModal}\n            content=\"Upload Media\"\n            labelPosition=\"right\"\n            icon=\"cloud upload\"\n          />\n        </Button.Group>\n        <FileModal\n          modal={modal}\n          closeModal={this.closeModal}\n          uploadFile={this.uploadFile}\n        />\n        <ProgressBar\n          uploadState={uploadState}\n          percentUploaded={percentUploaded}\n        />\n      </Segment>\n    );\n  }\n}\n\nexport default MessageForm;\n"]},"metadata":{},"sourceType":"module"}