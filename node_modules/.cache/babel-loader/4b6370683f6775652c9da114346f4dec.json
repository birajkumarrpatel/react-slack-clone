{"ast":null,"code":"import _toConsumableArray from\"C:/Users/BIRAJ/Desktop/react-slack-clone/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _defineProperty from\"C:/Users/BIRAJ/Desktop/react-slack-clone/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _classCallCheck from\"C:/Users/BIRAJ/Desktop/react-slack-clone/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"C:/Users/BIRAJ/Desktop/react-slack-clone/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"C:/Users/BIRAJ/Desktop/react-slack-clone/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"C:/Users/BIRAJ/Desktop/react-slack-clone/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from\"react\";import{Segment,Comment}from\"semantic-ui-react\";import{connect}from\"react-redux\";import{setUserPosts}from\"../../actions\";import firebase from\"../../firebase\";import MessagesHeader from\"./MessagesHeader\";import MessageForm from\"./MessageForm\";import Message from\"./Message\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Messages=/*#__PURE__*/function(_React$Component){_inherits(Messages,_React$Component);var _super=_createSuper(Messages);function Messages(){var _this;_classCallCheck(this,Messages);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={privateChannel:_this.props.isPrivateChannel,privateMessagesRef:firebase.database().ref(\"privateMessages\"),messagesRef:firebase.database().ref(\"messages\"),messages:[],messagesLoading:true,channel:_this.props.currentChannel,isChannelStarred:false,user:_this.props.currentUser,usersRef:firebase.database().ref(\"users\"),numUniqueUsers:\"\",searchTerm:\"\",searchLoading:false,searchResults:[]};_this.addListeners=function(channelId){_this.addMessageListener(channelId);};_this.addMessageListener=function(channelId){var loadedMessages=[];var ref=_this.getMessagesRef();ref.child(channelId).on(\"child_added\",function(snap){loadedMessages.push(snap.val());_this.setState({messages:loadedMessages,messagesLoading:false});_this.countUniqueUsers(loadedMessages);_this.countUsersPosts(loadedMessages);});};_this.addUserStarsListener=function(channelId,userId){_this.state.usersRef.child(userId).child(\"starred\").once(\"value\").then(function(data){if(data.val()!==null){var channelIds=Object.keys(data.val());var prevStarred=channelIds.includes(channelId);_this.setState({isChannelStarred:prevStarred});}});};_this.getMessagesRef=function(){var _this$state=_this.state,messagesRef=_this$state.messagesRef,privateMessagesRef=_this$state.privateMessagesRef,privateChannel=_this$state.privateChannel;return privateChannel?privateMessagesRef:messagesRef;};_this.handleStar=function(){_this.setState(function(prevState){return{isChannelStarred:!prevState.isChannelStarred};},function(){return _this.starChannel();});};_this.starChannel=function(){if(_this.state.isChannelStarred){_this.state.usersRef.child(\"\".concat(_this.state.user.uid,\"/starred\")).update(_defineProperty({},_this.state.channel.id,{name:_this.state.channel.name,daetails:_this.state.channel.details,createdBy:{name:_this.state.channel.createdBy.name,avatar:_this.state.channel.createdBy.avatar}}));}else{_this.state.usersRef.child(\"\".concat(_this.state.user.uid,\"/starred\")).child(_this.state.channel.id).remove(function(err){if(err!==null){console.error(err);}});}};_this.handleSearchChange=function(event){_this.setState({searchTerm:event.target.value,searchLoading:true},function(){return _this.handleSearchMessages();});};_this.handleSearchMessages=function(){var channelMessages=_toConsumableArray(_this.state.messages);var regex=new RegExp(_this.state.searchTerm,\"gi\");var searchResults=channelMessages.reduce(function(acc,message){if(message.content&&message.content.match(regex)||message.user.name.match(regex)){acc.push(message);}return acc;},[]);_this.setState({searchResults:searchResults});setTimeout(function(){return _this.setState({searchLoading:false});},1000);};_this.countUniqueUsers=function(messages){var uniqueUsers=messages.reduce(function(acc,message){if(!acc.includes(message.user.name)){acc.push(message.user.name);}return acc;},[]);var plural=uniqueUsers.length>1||uniqueUsers.length===0;var numUniqueUsers=\"\".concat(uniqueUsers.length,\" user\").concat(plural?\"s\":\"\");_this.setState({numUniqueUsers:numUniqueUsers});};_this.countUsersPosts=function(messages){var userPosts=messages.reduce(function(acc,message){if(message.user.name in acc){acc[message.user.name].count+=1;}else{acc[message.user.name]={avatar:message.user.avatar,count:1};}return acc;},{});_this.props.setUserPosts(userPosts);};_this.displayMessages=function(messages){return messages.length>0&&messages.map(function(message){return/*#__PURE__*/_jsx(Message,{message:message,user:_this.state.user},message.timestamp);});};_this.displayChannelName=function(channel){return channel?\"\".concat(_this.state.privateChannel?\"@\":\"#\").concat(channel.name):\"\";};return _this;}_createClass(Messages,[{key:\"componentDidMount\",value:function componentDidMount(){var _this$state2=this.state,channel=_this$state2.channel,user=_this$state2.user;if(channel&&user){this.addListeners(channel.id);this.addUserStarsListener(channel.id,user.uid);}}},{key:\"render\",value:function render(){// prettier-ignore\nvar _this$state3=this.state,messagesRef=_this$state3.messagesRef,messages=_this$state3.messages,channel=_this$state3.channel,user=_this$state3.user,numUniqueUsers=_this$state3.numUniqueUsers,searchTerm=_this$state3.searchTerm,searchResults=_this$state3.searchResults,searchLoading=_this$state3.searchLoading,privateChannel=_this$state3.privateChannel,isChannelStarred=_this$state3.isChannelStarred;return/*#__PURE__*/_jsxs(React.Fragment,{children:[/*#__PURE__*/_jsx(MessagesHeader,{channelName:this.displayChannelName(channel),numUniqueUsers:numUniqueUsers,handleSearchChange:this.handleSearchChange,searchLoading:searchLoading,isPrivateChannel:privateChannel,handleStar:this.handleStar,isChannelStarred:isChannelStarred}),/*#__PURE__*/_jsx(Segment,{children:/*#__PURE__*/_jsx(Comment.Group,{className:\"messages\",children:searchTerm?this.displayMessages(searchResults):this.displayMessages(messages)})}),/*#__PURE__*/_jsx(MessageForm,{messagesRef:messagesRef,currentChannel:channel,currentUser:user,isPrivateChannel:privateChannel,getMessagesRef:this.getMessagesRef})]});}}]);return Messages;}(React.Component);export default connect(null,{setUserPosts:setUserPosts})(Messages);","map":{"version":3,"sources":["C:/Users/BIRAJ/Desktop/react-slack-clone/src/components/Messages/Messages.js"],"names":["React","Segment","Comment","connect","setUserPosts","firebase","MessagesHeader","MessageForm","Message","Messages","state","privateChannel","props","isPrivateChannel","privateMessagesRef","database","ref","messagesRef","messages","messagesLoading","channel","currentChannel","isChannelStarred","user","currentUser","usersRef","numUniqueUsers","searchTerm","searchLoading","searchResults","addListeners","channelId","addMessageListener","loadedMessages","getMessagesRef","child","on","snap","push","val","setState","countUniqueUsers","countUsersPosts","addUserStarsListener","userId","once","then","data","channelIds","Object","keys","prevStarred","includes","handleStar","prevState","starChannel","uid","update","id","name","daetails","details","createdBy","avatar","remove","err","console","error","handleSearchChange","event","target","value","handleSearchMessages","channelMessages","regex","RegExp","reduce","acc","message","content","match","setTimeout","uniqueUsers","plural","length","userPosts","count","displayMessages","map","timestamp","displayChannelName","Component"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport { Segment, Comment } from \"semantic-ui-react\";\nimport { connect } from \"react-redux\";\nimport { setUserPosts } from \"../../actions\"\nimport firebase from \"../../firebase\";\n\nimport MessagesHeader from \"./MessagesHeader\";\nimport MessageForm from \"./MessageForm\";\nimport Message from \"./Message\";\n\nclass Messages extends React.Component {\n  state = {\n    privateChannel: this.props.isPrivateChannel,\n    privateMessagesRef: firebase.database().ref(\"privateMessages\"),\n    messagesRef: firebase.database().ref(\"messages\"),\n    messages: [],\n    messagesLoading: true,\n    channel: this.props.currentChannel,\n    isChannelStarred: false,\n    user: this.props.currentUser,\n    usersRef: firebase.database().ref(\"users\"),\n    numUniqueUsers: \"\",\n    searchTerm: \"\",\n    searchLoading: false,\n    searchResults: []\n  };\n\n  componentDidMount() {\n    const { channel, user } = this.state;\n\n    if (channel && user) {\n      this.addListeners(channel.id);\n      this.addUserStarsListener(channel.id, user.uid);\n    }\n  }\n\n  addListeners = channelId => {\n    this.addMessageListener(channelId);\n  };\n\n  addMessageListener = channelId => {\n    let loadedMessages = [];\n    const ref = this.getMessagesRef();\n    ref.child(channelId).on(\"child_added\", snap => {\n      loadedMessages.push(snap.val());\n      this.setState({\n        messages: loadedMessages,\n        messagesLoading: false\n      });\n      this.countUniqueUsers(loadedMessages);\n      this.countUsersPosts(loadedMessages);\n    });\n  };\n\n  addUserStarsListener = (channelId, userId) => {\n    this.state.usersRef\n      .child(userId)\n      .child(\"starred\")\n      .once(\"value\")\n      .then(data => {\n        if(data.val() !== null){\n          const channelIds = Object.keys(data.val()) \n          const prevStarred = channelIds.includes(channelId);\n          this.setState({ isChannelStarred: prevStarred });\n        }\n      });\n  }\n\n  getMessagesRef = () => {\n    const { messagesRef, privateMessagesRef, privateChannel } = this.state;\n    return privateChannel ? privateMessagesRef : messagesRef;\n  };\n\n  handleStar = () => {\n    this.setState(prevState => ({\n      isChannelStarred: !prevState.isChannelStarred\n    }), () => this.starChannel());\n  }\n\n  starChannel = () => {\n    if(this.state.isChannelStarred){\n      this.state.usersRef\n        .child(`${this.state.user.uid}/starred`)\n        .update({\n          [this.state.channel.id]:{\n            name: this.state.channel.name,\n            daetails: this.state.channel.details,\n            createdBy: {\n              name: this.state.channel.createdBy.name,\n              avatar: this.state.channel.createdBy.avatar\n            }\n          }\n        });\n    } else {\n        this.state.usersRef\n          .child(`${this.state.user.uid}/starred`)\n          .child(this.state.channel.id)\n          .remove(err => {\n            if(err !== null){\n              console.error(err);\n            }\n          });\n      }\n  }\n\n  handleSearchChange = event => {\n    this.setState(\n      {\n        searchTerm: event.target.value,\n        searchLoading: true\n      },\n      () => this.handleSearchMessages()\n    );\n  };\n\n  handleSearchMessages = () => {\n    const channelMessages = [...this.state.messages];\n    const regex = new RegExp(this.state.searchTerm, \"gi\");\n    const searchResults = channelMessages.reduce((acc, message) => {\n      if (\n        (message.content && message.content.match(regex)) ||\n        message.user.name.match(regex)\n      ) {\n        acc.push(message);\n      }\n      return acc;\n    }, []);\n    this.setState({ searchResults });\n    setTimeout(() => this.setState({ searchLoading: false }), 1000);\n  };\n\n  countUniqueUsers = messages => {\n    const uniqueUsers = messages.reduce((acc, message) => {\n      if (!acc.includes(message.user.name)) {\n        acc.push(message.user.name);\n      }\n      return acc;\n    }, []);\n    const plural = uniqueUsers.length > 1 || uniqueUsers.length === 0;\n    const numUniqueUsers = `${uniqueUsers.length} user${plural ? \"s\" : \"\"}`;\n    this.setState({ numUniqueUsers });\n  };\n\n  countUsersPosts = messages => {\n    let userPosts = messages.reduce((acc, message) => {\n      if(message.user.name in acc) {\n        acc[message.user.name].count += 1;\n      } else {\n        acc[message.user.name] = {\n          avatar: message.user.avatar,\n          count: 1\n        }\n      }\n      return acc;\n    }, {});\n    this.props.setUserPosts(userPosts);\n  }\n\n  displayMessages = messages =>\n    messages.length > 0 &&\n    messages.map(message => (\n      <Message\n        key={message.timestamp}\n        message={message}\n        user={this.state.user}\n      />\n    ));\n\n  displayChannelName = channel => {\n    return channel\n      ? `${this.state.privateChannel ? \"@\" : \"#\"}${channel.name}`\n      : \"\";\n  };\n\n  render() {\n    // prettier-ignore\n    const { messagesRef, messages, channel, user, numUniqueUsers, searchTerm,\n    searchResults, searchLoading, privateChannel, isChannelStarred } = this.state;\n\n    return (\n      <React.Fragment>\n        <MessagesHeader\n          channelName={this.displayChannelName(channel)}\n          numUniqueUsers={numUniqueUsers}\n          handleSearchChange={this.handleSearchChange}\n          searchLoading={searchLoading}\n          isPrivateChannel={privateChannel}\n          handleStar={this.handleStar}\n          isChannelStarred={isChannelStarred}\n        />\n\n        <Segment>\n          <Comment.Group className=\"messages\">\n            {searchTerm\n              ? this.displayMessages(searchResults)\n              : this.displayMessages(messages)}\n          </Comment.Group>\n        </Segment>\n\n        <MessageForm\n          messagesRef={messagesRef}\n          currentChannel={channel}\n          currentUser={user}\n          isPrivateChannel={privateChannel}\n          getMessagesRef={this.getMessagesRef}\n        />\n      </React.Fragment>\n    );\n  }\n}\n\nexport default connect(null, { setUserPosts }) (Messages);\n"]},"metadata":{},"sourceType":"module"}